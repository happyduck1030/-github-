"use strict";const t=require("../../common/vendor.js"),e=require("../../utils/check.js"),o=require("../../common/assets.js"),a={components:{CustomModal:()=>"../../component/custom-modal/custom-modal.js"},data:()=>({isOpen:getApp().globalData.isOP,inner:getApp().globalData.in,chairId:-1,status:!1,username:"暂无",canOperate:!0,showModal:!1}),methods:{showCustomModal(){this.showModal=!0},handleConfirm(t){e.register(t.name,t.className),this.showModal=!1},handleClose(){this.showModal=!1},toOpenDoor(){t.index.navigateTo({url:"/pages/openDoor/openDoor"})},getChairById(){const e=t.index.getStorageSync("token");""===e?t.index.request({url:"https://turingteam.xyz:9642/getChairById",method:"GET",data:{id:this.chairId},success:t=>{console.log(t),200===t.data.code&&(this.status=t.data.data.status,this.username=t.data.data.username,this.canOperate=t.data.data.canOperate)},fail:t=>{console.log(t)}}):t.index.request({url:"https://turingteam.xyz:9642/getChairById",method:"GET",data:{id:this.chairId},header:{Authorization:e},success:t=>{console.log(t),200===t.data.code&&(this.status=t.data.data.status,this.username=t.data.data.username,this.canOperate=t.data.data.canOperate)},fail:t=>{console.log(t)}})},signIn(){if(""==t.index.getStorageSync("token"))return console.log("未登录"),void e.login(this.sitDown,this.showCustomModal);this.sitDown()},sitDown(){const o=t.index.getStorageSync("token");""!=o&&t.index.request({url:"https://turingteam.xyz:9642/work".concat("?chairId=",this.chairId),method:"PUT",header:{Authorization:o},success:o=>{200==o.data.code?(t.index.showToast({title:"加载中",icon:"loading",duration:700,mask:!0}),setTimeout((()=>{this.getChairById()}),700)):400===o.data.code?(t.index.showToast({title:o.data.msg,icon:"error",mask:!0}),setTimeout((()=>{t.index.reLaunch({url:"/pages/seat/seat"})}),1500)):403===o.data.code&&e.login(this.sitDown,this.showCustomModal)},fail:t=>{console.log(t)}})},signOut(){if(""==t.index.getStorageSync("token"))return console.log("未登录"),void e.login(this.leave,this.showCustomModal);this.leave()},leave(){const o=t.index.getStorageSync("token");""!==o&&t.index.request({url:"https://turingteam.xyz:9642/life".concat("?chairId=",this.chairId),method:"PUT",header:{Authorization:o},success:o=>{200==o.data.code?(t.index.showToast({title:"加载中",icon:"loading",duration:700,mask:!0}),setTimeout((()=>{this.getChairById()}),700)):403===o.data.code&&e.login(this.leave,this.showCustomModal)},fail:t=>{console.log(t)}})}},onLoad(o){const a=t.index.getStorageSync("token");this.chairId=o.id,this.getChairById(),""==a&&e.login2()}};if(!Array){(t.resolveComponent("uni-notice-bar")+t.resolveComponent("CustomModal"))()}Math;const s=t._export_sfc(a,[["render",function(e,a,s,n,i,r){return t.e({a:t.o(r.toOpenDoor),b:t.p({single:!0,color:i.isOpen?"#00917c":"#fff","background-color":i.isOpen?"#caf7e3":"red",text:i.isOpen?"实验室已开门，点此修正开门状态":"暂未开门，请在群里询问或点此修正开门状态"}),c:t.t(this.chairId),d:t.t(this.username),e:i.isOpen},i.isOpen?t.e({f:t.t(i.status?"正在使用":"空闲"),g:t.n(i.status?"unfreeText":"freeText"),h:!i.status},i.status?{}:t.e({i:o._imports_0$2,j:!i.inner,k:t.o(((...t)=>r.signIn&&r.signIn(...t))),l:!i.inner},(i.inner,{}),{m:!i.inner},(i.inner,{})),{n:i.status&&i.canOperate},i.status&&i.canOperate?{o:o._imports_1,p:t.o(((...t)=>r.signOut&&r.signOut(...t)))}:{},{q:i.status&&!i.canOperate},i.status&&!i.canOperate?{r:o._imports_1}:{}):{},{s:!i.isOpen},i.isOpen?{}:{t:o._imports_2,v:t.o(((...t)=>r.toOpenDoor&&r.toOpenDoor(...t)))},{w:t.o(r.handleConfirm),x:t.o(r.handleClose),y:i.showModal})}],["__scopeId","data-v-c09283d9"]]);wx.createPage(s);
